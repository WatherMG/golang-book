# 5.3 Множественные возвращаемые значения

Функция может возвращать более одного результата (например, желаемый результат вычислений и значение ошибки, либо
логическое значение, указывающее, были ли вычисления корректно выполнены).

В примере (см. findlinks2.go) показано, как написать собственную функцию с несколькими возвращаемыми значениями. Она
является версией программы `findlinks`, которая сама выполняет запрос HTTP, так что нам больше не нужно запускать
программу `fetch`. Поскольку и запрос HTTP, и синтаксический анализ могут быть неудачными, функция `findlinks` объявляет
два результата: список обнаруженных ссылок и ошибку.

HTML-анализатор обычно может восстановиться при некорректных входных данных и построить документ, содержащий узлы
ошибок,
так что функция `Parse` редко бывает неудачной. Когда такое происходит, это, как правило, связанно с ошибками
ввода-вывода.

В функции `findlinks` имеются четыре оператора `return`, каждый из которых возвращает пару значений. Первые три
заставляют функцию передавать информацию об ошибке из пакетов `http` и `html` вызывающей функции.

* В первом случае ошибка возвращается без изменений.
* Во втором и третьем она дополняется контекстной информацией с помощью функции `fmt.Errorf`.
* Если вызов `findlinks` является успешным, последний оператор `return` возвращает срез ссылок без указания ошибки.

Мы должны гарантировать закрытие `reps.Body`, чтобы даже в случае ошибки сетевые ресурсы были освобождены должным
образом. Сборщик мусора Go освобождает неиспользуемую память, но не считайте, что он будет освобождать неиспользуемые
ресурсы операционной системы, такие как открытые файлы и сетевые подключения. Они должны быть закрыты явным образом.

Результат вызова многозначной функции представляет собой кортеж значений. При вызове такой функции необходимо явным
образом присваивать значения переменным, если любая из них должна быть использована:

``` go
links, err := findLinks(url)
```

Чтобы проигнорировать одно из значений, нужно присвоить его пустому идентификатору `_`:

``` go
links, _ := findLinks(url) // Ошибка проигнорированна
```

Результат многозначного вызова сам может быть получен из вызова многозначной функции, как в приведенном ниже примере
функции, которая ведет себя как `findLinks`, но записывает свой аргумент:

``` go
func findLinksLog(url string) ([]string, error) {
 log.PrintF("findlinks %s", url)
 return findlinks(url)
}
```

Многозначный вызов может являться единственным аргументом при вызове функции с несколькими параметрами. Хотя такое редко
используется в промышленном коде, эта возможность иногда оказывается удобной во время отладки, так как позволяет нам
выводить все результаты вызова с помощью одной инструкции. Приведенные далее два выражения вывода работают одинаково:

``` go
log.Println(findLinks(url)
links, err := findLinks(url)
fmt.Println(links, err)
```

Тщательно подобранные имена могут документировать смысл результатов функции. Имена являются особенно важными, когда
функция возвращает несколько результатов одного и того же типа, как, например:

``` go
func Size(rect image.Rectangle) (width, height int)
func Split(path string) (dir, file string)
func HourMinSec(t time.Time) (hour, minute, second int)
```

Однако не всегда необходимо именовать несколько результатов исключительно для документирования. Например, по соглашению,
последний результат типа `bool` указывает успешное выполнение функции. Результат `error` часто не требует никаких
пояснений.

В функции с именованными результатами операнды оператора return могут быть опущены. Это называется
**_пустым возвратом (bare return)_**

``` go
// CountWordsAndImages выполняет HTTP-запрос GET HTML-документа url и возвращает количество слов и изображений в нем.
func CountWordsAndImages(url string) (words, images int, err error) {
    resp, err := http.Get(url)
    if err != nil {
        return
    }
    doc, err := html.Parse(resp.body)
    resp.Body.Close()
    if err != nil {
        err = fmt.Errorf("parsing HTML: %s", err)
        return
    }
    words, images = countWordsAndImages(doc)
    return
}

func countWordsAndImages(n *html.Node) (words, images int) { /*...*/ }
```

Пустой возврат представляет собой сокращенную запись для возврата всех именованных результирующих переменных в
указанном объявлении порядке, так что в приведенной выше функции каждая инструкция `return` эквивалентна записи:

``` go
return words, images, err
```

В функциях подобной этой, в которых имеется много операторов `return` и несколько результатов, пустой возврат может
уменьшить дублирование кода, но он редко облегчает понимание исходного текста. Например, на первый взгляд не очевидно,
что два первых возврата эквивалентны `return 0, 0, err` (поскольку результирующие переменные words и images
инициализируются нулевыми значениями соответствующего типа) и что окончательная инструкция `return` эквивалентна записи
`return words, images, nil`. По этой причине **_пустой возврат_** лучше всего использовать **в редких случаях**.

## Выводы:

* Функции могут возвращать несколько значений, что полезно для возврата результата и информации об ошибке или статуса
  выполнения;  
  Пример: `func Size(rect image.Rectangle) (width, height int)`;
* Сборщик мусора Go освобождает память, но не освобождает ресурсы операционной системы, такие как открытые файлы и
  сетевые подключения. Они должны быть закрыты явным образом, например `file.Close()`, `resp.Body.Close()`;
* Результат вызова функции с несколькими возвращаемыми значениями представляет собой кортеж значений. При вызове такой
  функции необходимо явно присваивать ее значения переменным или использовать `_` для игнорирования ненужных значений;
  Пример: `links, err := findLinks(url)`, `links, _ := findLinks(url)`;
* Результат многозначного вызова может быть использован в качестве аргумента для другой функции с несколькими
  параметрами, что может быть полезно при отладке;
  Пример: `log.Println(findLinks(url))`;
* Нужно использовать осознанные имена для возвращаемых значений, особенно если они одного типа, чтобы облегчить
  понимание функции;
  Пример: `func Split(path string) (dir, file string)`;
* Если последнее возвращаемое значение функции типа `bool`, `по соглашению` оно указывает на успешное или неуспешное
  выполнение функции;
* В функции с именованными результатами можно использовать `пустой возврат (bare return)` - оператор `return` без
  операндов. Это может уменьшить дублирование кода, но иногда усложняет понимание функции;
  Пример:
  ``` go
  func CountWordsAndImages(url string) (words, images int, err error) {
      //...
      if err != nil {
          return
      }
      //...
  }
  ```