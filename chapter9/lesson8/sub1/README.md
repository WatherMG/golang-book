# 9.8.1. Растущие стеки

Каждый `поток` операционной системы имеет блок памяти фиксированного размера (зачастую `до 2 Мбайт`) **для стека** —
рабочей области, в которой он хранит локальные переменные вызовов функций, находящиеся в работе или приостановленные на
время вызова другой функции. Такой стек фиксированного размера является одновременно слишком большим и слишком
малым. `Стек
размером 2 Мбайта` оказывается **огромной тратой памяти для небольшой горутины**, которая, например, просто ожидает
`WaitGroup`, **а затем закрывает канал**. Для программ Go не редкость одновременное создание сотен тысяч горутин, что
было бы невозможно с такими большими стеками. Тем не менее стеков фиксированного размера, несмотря на их большие
размеры, не всегда достаточно для сложных и глубоко рекурсивных функций. Изменение фиксированного размера стека может
**повысить эффективность использования памяти** и **позволить создавать большее количество потоков** `или` **разрешить
включать рекурсивные функции с большей глубиной**, но не может одновременно обеспечить и то, и другое.

В противоположность этому горутина начинает работу **с небольшим стеком, обычно около 2 Кбайт**. Стек
горутины, подобно стеку потока операционной системы, **хранит локальные переменные активных и приостановленных
функций**, но, в отличие от потоков операционной
системы, `не является фиксированным`; `при необходимости он может расти и
уменьшаться`. **Максимальный размер стека горутины** может быть около `1 Гбайта`, на порядки больше типичного стека с
фиксированным размером, хотя, конечно, такой большой стек могут использовать только несколько горутин.

## Выводы:

* Потоки операционной системы имеют блок памяти фиксированного размера для стека, обычно около `2 Мбайт`; это область
  для хранения локальных переменных вызовов функций, находящихся в работе или приостановленных;
* Фиксированный размер стека может быть как `слишком большим для простых задач`, так
  и `слишком малым для сложных и глубоко рекурсивных функций`; это создает проблемы с использованием памяти и
  ограничивает количество одновременных потоков;
* В Go используются горутины, которые начинают работу с небольшим стеком, обычно около `2 Кбайт`, что **экономит память
  и позволяет создавать большее количество горутин**;
* Стек горутины может **расти и уменьшаться** в зависимости от необходимости, что обеспечивает более эффективное
  использование памяти, больше одновременных потоков и возможность работы с рекурсивными функциями большей глубины;
* Максимальный размер стека горутины в Go может достигать `1 Гбайта`, что обеспечивает гораздо большую гибкость по
  сравнению со стеками фиксированного размера;
* Использование горутин и динамически изменяемых стеков в Go позволяет повысить производительность и эффективность
  программ, делая их масштабируемыми и адаптивными к различным задачам и условиям выполнения.